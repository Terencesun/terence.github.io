{"title":"consul 单机集群搭建","date":"2021-03-16T06:15:03.000Z","date_formatted":{"ll":"Mar 16, 2021","L":"03/16/2021","MM-DD":"03-16"},"link":"2021/03/16/2021-03-16-01","comments":true,"tags":["consul"],"updated":"2021-03-16T07:57:36.146Z","content":"<blockquote>\n<p>记录一下单机搭建集群<br>\n两个server节点和一个client节点</p>\n</blockquote>\n<hr>\n<div class=\"φbt\"><div class=\"φbv\"><table><thead>\n<tr>\n<th>节点名称</th>\n<th>节点类型</th>\n<th>http</th>\n<th>dns</th>\n<th>serf_lan</th>\n<th>serf_wan</th>\n<th>server</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>n1</td>\n<td>server</td>\n<td>8501</td>\n<td>8601</td>\n<td>20001</td>\n<td>20002</td>\n<td>8000</td>\n</tr>\n<tr>\n<td>n2</td>\n<td>server</td>\n<td>8502</td>\n<td>8602</td>\n<td>21001</td>\n<td>21002</td>\n<td>8001</td>\n</tr>\n<tr>\n<td>n3</td>\n<td>client</td>\n<td>8500</td>\n<td>8600</td>\n<td>x</td>\n<td>x</td>\n<td>x</td>\n</tr>\n</tbody>\n</table></div></div><ol>\n<li>server配置</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x2F;&#x2F; n1的配置</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;datacenter&quot;: &quot;dc1&quot;,</span><br><span class=\"line\">  &quot;data_dir&quot;: &quot;&#x2F;consule-tmp&#x2F;n1&quot;,</span><br><span class=\"line\">  &quot;log_level&quot;: &quot;INFO&quot;,</span><br><span class=\"line\">  &quot;node_name&quot;: &quot;n1&quot;,</span><br><span class=\"line\">  &quot;server&quot;: true,</span><br><span class=\"line\">  &quot;bootstrap_expect&quot;: 2,</span><br><span class=\"line\">  &quot;bind_addr&quot;: &quot;192.168.217.68&quot;,</span><br><span class=\"line\">  &quot;client_addr&quot;: &quot;0.0.0.0&quot;,</span><br><span class=\"line\">  &quot;ui&quot;: true,</span><br><span class=\"line\">  &quot;encrypt&quot;: &quot;EXz7LFN8hpQ4id8EDYiFoQ&#x3D;&#x3D;&quot;,</span><br><span class=\"line\">  &quot;retry_join&quot;: [&quot;192.168.217.68:20001&quot;, &quot;192.168.217.68:21001&quot;],</span><br><span class=\"line\">  &quot;retry_interval&quot;: &quot;30s&quot;,</span><br><span class=\"line\">  &quot;enable_debug&quot;: false,</span><br><span class=\"line\">  &quot;rejoin_after_leave&quot;: true,</span><br><span class=\"line\">  &#x2F;&#x2F; 下面start_join是指第一次直接加入某个节点群，减少与其他节点的启动竞争</span><br><span class=\"line\">  &#x2F;&#x2F; 不加这个配置项，那么就走retry_join</span><br><span class=\"line\">  &#x2F;&#x2F; &quot;start_join&quot;: [&quot;192.168.217.68&quot;],</span><br><span class=\"line\">  &quot;ports&quot;: &#123;</span><br><span class=\"line\">\t&quot;dns&quot;: 8602,</span><br><span class=\"line\">\t&quot;http&quot;: 8502,</span><br><span class=\"line\">\t&quot;https&quot;: -1,</span><br><span class=\"line\">\t&quot;serf_lan&quot;: 20001,</span><br><span class=\"line\">\t&quot;serf_wan&quot;: 20002,</span><br><span class=\"line\">\t&quot;server&quot;: 8001</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#x2F;&#x2F; n2改下端口号就可以</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>client配置</li>\n</ol>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;datacenter&quot;: &quot;dc1&quot;,</span><br><span class=\"line\">  &quot;data_dir&quot;: &quot;&#x2F;consule-tmp&#x2F;n3&quot;,</span><br><span class=\"line\">  &quot;log_level&quot;: &quot;INFO&quot;,</span><br><span class=\"line\">  &quot;node_name&quot;: &quot;n3&quot;,</span><br><span class=\"line\">  &quot;server&quot;: false,</span><br><span class=\"line\">  &quot;bind_addr&quot;: &quot;192.168.217.68&quot;,</span><br><span class=\"line\">  &quot;client_addr&quot;: &quot;0.0.0.0&quot;,</span><br><span class=\"line\">  &quot;ui&quot;: true,</span><br><span class=\"line\">  &quot;encrypt&quot;: &quot;EXz7LFN8hpQ4id8EDYiFoQ&#x3D;&#x3D;&quot;,</span><br><span class=\"line\">  &quot;retry_join&quot;: [&quot;192.168.217.68:20001&quot;, &quot;192.168.217.68:21001&quot;],</span><br><span class=\"line\">  &quot;retry_interval&quot;: &quot;30s&quot;,</span><br><span class=\"line\">  &quot;enable_debug&quot;: false,</span><br><span class=\"line\">  &quot;rejoin_after_leave&quot;: true</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","prev":{"title":"常用的哈希算法比较","link":"2021/04/08/2021-04-08"},"next":{"title":"【转载】Go 项目实战：实现一个 Redis(9) 之 使用 GeoHash 搜索附近的人","link":"2021/03/14/2021-03-13-10"},"plink":"https://terence.segofun.com/2021/03/16/2021-03-16-01/"}